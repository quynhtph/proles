/*! package 2015-11-05 */
var CapacityOverview=React.createClass({displayName:"CapacityOverview",mixins:[ChannelHelperMixin,SettingPopupMixin,InstanceSettingsResolveMixin,SettingsBindingMixin],functionId:null,languageObject:null,widgetData:null,settings:null,previousSettingTabOrder:0,isDefaultSettingsResolved:!1,classPrefix:"sib-widget-capacity-overview",bind:null,getInitialState:function(){return{isLoaded:!1,isSetting:!1}},componentWillMount:function(){var a=this;if(a.bind=_.partial(stringReplaceAll,_,"@classPrefix",a.classPrefix),a.props.widget.Settings)try{a.settings=JSON.parse(a.props.widget.Settings),a.isDefaultSettingsResolved=!0}catch(b){}else try{a.settings=JSON.parse(a.props.widgetTemplate.DefaultSettings)}catch(b){}a.functionId=a.props.widgetTemplate.FunctionId,postal.subscribe({channel:a.props.widget.Id,topic:"widget.events.resize",callback:function(b){b.beforeSizex!==b.sizex&&a.drawCharts(),$(window).trigger("resize")}})},componentDidMount:function(){var a=this,b=a.getLanguageObject(),c=new $.Deferred;b.done(function(b){a.languageObject=b,c.resolve()});var d=a.resolveDefaultSettings(),e=a.getJS();$.when(c,d,e).done(function(){a.setState({isLoaded:!0},a.initialize)})},render:function(){var a=this.bind;return this.state.isLoaded===!0?this.props.widget.Permission?React.createElement("div",{className:a("@classPrefix")},React.createElement("div",{className:"sib-widget-body-visible-section"},React.createElement("div",{className:"sib-widget-body-title-section"},React.createElement("div",{ref:"title",className:"sib-widget-body-title"}),React.createElement("div",{ref:"subtitle",className:"sib-widget-body-subtitle"})),React.createElement("div",{ref:"scrollableRoot",className:"sib-widget-body-content-section"},this.state.hasData?React.createElement("div",{ref:"chartDiv",style:{width:"100%"}}):React.createElement("div",{className:"sib-widget--no-data"},this.props.lang.widget.msgNoData))),this.state.isSetting?this.renderSettingComponents():null):React.createElement("div",{className:a("@classPrefix sib-widget--no-permission")},this.props.lang.widget.msgNoPermission):React.createElement("div",{className:a("@classPrefix")},React.createElement(Loading,null))},initialize:function(){var a=this;a.props.widget.Permission&&a.getData().done(function(b){a.widgetData=b;var c=a.languageObject.chart.title,d=moment(a.settings.dates.date1,prolesConfiguration.DATE_TIME.YYYYMMDD).format(a.languageObject.chart.titleDateFormatString),e=moment(a.settings.dates.date2,prolesConfiguration.DATE_TIME.YYYYMMDD).format(a.languageObject.chart.titleDateFormatString),f=_.template(a.languageObject.chart.subtitle)({dateFrom:d,dateTo:e});$(a.refs.title.getDOMNode()).html(c),$(a.refs.subtitle.getDOMNode()).html(f),a.setState({hasData:a.hasData(a.widgetData)},a.drawCharts);var g=$(a.refs.scrollableRoot.getDOMNode());g.hasClass("scrollable")||g.scrollable()})},hasData:function(a){return a&&0!==a.length},drawCharts:function(){var a=this;if(a.state.hasData){var b=$(a.refs.chartDiv.getDOMNode()),c=b.highcharts();c&&(c.destroy(),b.empty());var d=10,e=10,f=_.clone(a.widgetData),g=_.reduce(f,function(a,b){return a+=25},d+e),h=_.map(f,function(a){return a.EmployeeName}),i=_.map(f,function(a){return a.Hour});b.highcharts({chart:{type:"bar",marginTop:d,marginBottom:e,height:g},title:{text:null},credits:{enabled:!1},legend:{enabled:!1},xAxis:{categories:h},yAxis:{title:{text:null},labels:{overflow:"justify"}},tooltip:{valueDecimals:2,valueSuffix:a.languageObject.chart.valueSuffix},plotOptions:{bar:{dataLabels:{enabled:!0,formatter:function(a){return this.y<0?'<span style="color: red;">'+this.y.toFixed(2)+"</span>":this.y.toFixed(2)}},animation:{duration:100}}},series:[{name:a.languageObject.chart.seriesName,data:i}]})}},getLanguageObject:function(){return ProlesCapacityOverviewServiceManager.getLanguageObject()},getJS:function(){var a=new $.Deferred;return LazyLoad.js(["widgets/common/employeeSelector/employeeSelector.js","widgets/common/dateRange/dateRange.js"],function(){a.resolve()}),a.promise()},resolveDefaultSettings:function(){var a=this,b=new $.Deferred;return a.isDefaultSettingsResolved?b.resolve():a.getEmployeesForSettings().done(function(){a.isDefaultSettingsResolved=!0,a.updateInstanceSettings().done(function(){b.resolve()})}),b.promise()},getData:function(){var a=this,b=new $.Deferred,c=a.settings.dates.expression;c&&(a.settings.dates=RelativeDateResolver.resolveDateRange(c));var d=a.settings.dates.date1,e=a.settings.dates.date2;return a.resolveAllEmployees(a.settings.employees).done(function(a){ProlesCapacityOverviewServiceManager.getCapacityOverview(a,d,e).done(function(a){b.resolve(a)})}),b.promise()},renderSettingComponents:function(){var a=this,b=new $.Deferred,c=new $.Deferred,d=React.createElement(EmployeeSelector,{user:a.props.user,widget:a.props.widget,widgetTemplate:a.props.widgetTemplate,settings:a.settings,settingProgress:b,notifyCollectSettings:c,bindEmployeeSettings:a.bindEmployeeSettings}),e=React.createElement(DateRange,{settingProgress:b,notifyCollectSettings:c,bindDateSettings:a.bindDateRangeSettings}),f=React.createElement(WidgetSettings,{widget:a.props.widget,innerChannel:a.innerChannel,tabs:[{tabName:"Employees",tabPane:d},{tabName:"Dates",tabPane:e}],settingProgress:b,notifyCollectSettings:c,previousSettingTabOrder:a.previousSettingTabOrder,settingsTabClicked:a.settingsTabClicked,bindSettingsCollected:a.bindSettingsCollected});return f}});